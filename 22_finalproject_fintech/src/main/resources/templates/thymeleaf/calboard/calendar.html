<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
>

<head>

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta name="description" content="" />
    <meta name="author" content="" />
    <title>SSM</title>
    <script type="text/javascript" src="http://code.jquery.com/jquery-latest.js"></script>
    <!-- Favicon-->
    <link rel="icon" type="image/x-icon" href="resources/assets/favicon.ico" />
    <!-- Core theme CSS (includes Bootstrap)-->
    <link href="/resources/css/styles.css" rel="stylesheet" />
   <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
<title></title>
<style type="text/css">
   #content{
   width: 1200px;
     margin: 0 auto;
    font-size:12px;
   }
   .money{
   width:1020px;
   margin: 0 auto;
   text-align: center;
   }
   .cal{
   width: 1200px;
   text-align: center;
   margin: 0 auto;
   }
   .cal #thead > div{
   display: inline-block;
   width: 168px;
   text-align: center;
   }
   
/*     날짜표현 div */
    .cal #tbody > div{
       height: 130px;
       vertical-align: top;
       border-top:1px solid gray;
       display: inline-block;
         width: 170px;
         float: left;
    }            
    #ctitle{
       text-align: center;
    }         
    
    .pen{
       width: 20px;
       height: 20px;
    }      
    .d{
       font-weight: bold;
       text-align: center;
    }    
    
    #tbody > div > p{background-color:#a9bcf5; border: 1px solid darkgray; color:darksgray;}
    
    .cp{
       position : absolute;
       left : 20px;
       top : -30px;
       width: 40px;
       height : 40px;
       border-radius: 20px 20px 20px 1px;
       background-color:aliceblue;
       line-height : 40px;
       text-align: center;
       font-weight: bold;
    }
    #ctitle{
    font-size: 15px;
    text-align:center;
    }
    
    /* Style The Dropdown Button */
   .dropbtn {
     background-color: #277BC0;
     color: white;
     padding: 10px;
     font-size: 16px;
     border: none;
     cursor: pointer;
   }
   
   /* The container <div> - needed to position the dropdown content */
   .dropdown {
     position: relative;
     display: inline-block;
   }
   
   /* Dropdown Content (Hidden by Default) */
   .dropdown-content {
     display: none;
     position: absolute;
     background-color: #f9f9f9;
     min-width: 160px;
     box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
     z-index: 1;
     
   }
   
   /* Links inside the dropdown */
   .dropdown-content a {
     color: black;
     padding: 12px 16px;
     text-decoration: none;
     display: block;
   }
   
   /* Change color of dropdown links on hover */
   .dropdown-content a:hover {background-color: #EAECCC}
   
   /* Show the dropdown menu on hover */
   .dropdown:hover .dropdown-content {
     display: block;
   }
   
   /* Change the background color of the dropdown button when the dropdown content is shown */
   .dropdown:hover .dropbtn {
     background-color: #EAECCC;
   }
    
</style>
<script type="text/javascript">
   $(function(){
   
      $(".d").each(function(i){
         //controller로 전달할 파라미터 yyyyMM를 구함
         var aDate=$(this); // 현재 마우스가 올라간 a태그구함
         var year = $(".y").text().trim(); // 년도
         var month = $(".m").text().trim(); // 월
         var date = aDate.text().trim(); // 일
         var yyyyMMdd = year+(month.length<2?"0"+month:month) + (date.length<2?"0" + date:date); // 8자리 만들기
         //alert(yyyyMMdd);
         console.log(aDate.nextAll("p").length);
         if(aDate.nextAll("p").length>0){
            $.ajax({
               url:"/schedule/calCountAjax",
               method:"get",
               data:{"yyyyMMdd":yyyyMMdd},   //서버로 전달하는 값
               dataType:"json",   //서버에서 전달받은 데이터 타입
               async:false,   //ajax()메서드가 비동기로 실행되는것을 막음:false설정
               success:function(data){ //성공하면 데이터가 data변수에 저장됨
               //   alert(data.count);
                   if(data.count>0){
                      aDate.hover(function(){
                         aDate.after("<div class='cp'>"+data.count+"</div>");
                      },function(){
                         $(".cp").remove(); // 마우스가 나갔을때
                      });
                   }
                   if(data.count>6){
                      //aDate.after("<div class='cp'>"+data.count+"</div>");    
                      aDate.nextAll("a").eq(0).click(function(e){
                         //e.preventDefault();
                         alert("예약 마감되었습니다.");
                         return false;
                      });          
                   }
               },
               error:function(){
                  alert("통신실패");
               }
            });
         }
      })
   });

</script>
</head>
<body>


<nav class="navbar navbar-expand-lg navbar-dark" style="font-size: 25px; font-family: Arial,  sans-serif; font-weight: bolder;  width: auto; background-color:white;">
   <div class="container" style="margin-left: 30px; width: auto;">           
      <img src="/resources/img/SSM.png" width="45" height="40" class="d-inline-block align-top" alt=""/>
      <a class="nav-link" href="/banking/main" style="color: #3C4048; font-family: Arial,  sans-serif; font-weight: bolder; " >
      S.S.M
      </a>           
        <div class="collapse navbar-collapse" id="navbarSupportedContent" style="margin-left: 750px; ">
            <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
                <ul class="nav-item"><a class="nav-link active" th:href="@{/banking/main}" style="color: #3C4048;" th:text="${session.ldto.username}+'님'"></a></ul>
<!--            <ul class="nav-item"><a class="nav-link" th:href="@{/schedule/calendar}" style="color: #3C4048;;">Calender</a></ul>-->
            <ul class="nav-item"><a class="nav-link" th:href="@{/schedule/calendar/myinfo}" style="color: #3C4048;;" th:onclick="myinfo()">MyPage</a></ul>
            <ul class="nav-item"><a class="nav-link" th:href="@{/user/logout}" style="color: #3C4048;">Logout</a></ul>
            </ul>
      </div>
   </div>
</nav>

<div class="a" style="background: #277BC0; height: 10px; "></div>
<div class="b" style="background: #4CB9E7; height: 5px; margin-left:20px;"></div>


<div class="content">
   <div class="money">
      <span>수입</span>
      <a th:href="@{/schedule/calendar(year=${calMap.year-1},month=${calMap.month})}">원</a>
      <span>지출</span>
      <a th:href="@{/schedule/calendar(year=${calMap.year},month=${calMap.month-1})}">원</a>
      <span>총 합</span>
      <span class="y" th:text="${calMap.year}">원</span>
   </div>
      
<!--      <h1>예약하기</h1>-->
      <div class="cal">
         <div id="ctitle">
            <a th:href="@{/schedule/calendar(year=${calMap.year-1},month=${calMap.month})}">◁</a>
            <a th:href="@{/schedule/calendar(year=${calMap.year},month=${calMap.month-1})}">◀</a>
            <span class="y" th:text="${calMap.year}"></span>
            <span>년</span>
            <span class="m" th:text="${calMap.month}"></span>
            <span>월</span>
            <a th:href="@{/schedule/calendar(year=${calMap.year},month=${calMap.month+1})}">▶</a>
            <a th:href="@{/schedule/calendar(year=${calMap.year+1},month=${calMap.month})}">▷</a>
         </div>
         <div id="thead">
            <div>일</div><div>월</div><div>화</div><div>수</div>
            <div>목</div><div>금</div><div>토</div>
         </div>
         <div id="tbody">
            <th:block th:if="${calMap.dayOfWeek>1}">
               <div th:each="num:${#numbers.sequence(1,calMap.dayOfWeek-1)}">&nbsp;</div>            
            </th:block>
            <th:block th:each="i:${#numbers.sequence(1,calMap.lastDay)}">
               <div>
                  <a data-bs-toggle="modal" data-bs-target="#exampleModal" class="d" th:text="${i}" data-toggle="modal" th:style="'color:'+${@util.fontColor(i,calMap.dayOfWeek)}"
                     th:attr="data-target=${'#exampleModal'}" >
<!--                      th:href="@{/schedule/calBoardList(year=${calMap.year},month=${calMap.month},date=${i})}"> -->
                  </a>
                  <a data-bs-toggle="modal" data-bs-target="#exampleModal2" th:attr="data-target=${'#exampleModal2'}">
                     <img class="pen" th:src="@{/img/pen.png}" />
                  </a>
              
               </div>
            </th:block>
         </div>
      </div>
 
   </div>  
   

<!--    <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#exampleModal"> -->
<!--   Launch demo modal -->
<!-- </button> -->
<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Modal title</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        ...
<!--         날짜 누르기 -> ajax에서 받아온 수입지출 data 받아서 여기에 뿌리기 -->
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary">Save changes</button>
      </div>
    </div>
  </div>
</div>   


<!--   현금 하는중~-->
    <div class="modal fade" id="exampleModal2" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">현금 수입•지출 등록하기</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
      	<form th:action="@{/schedule/addCalBoard}" method="post" th:object="${insertCalCommand}">
   		<input type="hidden" name="useremail" th:value="${session.ldto.useremail}"/>
        <table class="table">
  
  		<tr>
            <th>일정</th>
            <td>
               <select name="year" >
                  <th:block th:each="i:${#numbers.sequence(calMap.year-5,calMap.year+5)}">
                     <th:block th:if="${calMap.year == i}">
                        <option th:value="${i}" th:text="${i}" selected="selected"></option>
                     </th:block>
                     <th:block th:unless="${calMap.year == i}">
                        <option th:value="${i}" th:text="${i}"></option>
                     </th:block>
                  </th:block>
               </select>년
              <select name="month" >
                  <th:block th:each="i:${#numbers.sequence(1,12)}">
                     <th:block th:if="${calMap.month == i}">
                        <option th:value="${i}" th:text="${i}" selected="selected"></option>
                     </th:block>
                     <th:block th:unless="${calMap.month == i}">
                        <option th:value="${i}" th:text="${i}"></option>
                     </th:block>
                  </th:block>
               </select>월
               <select name="date" >
                  <th:block th:each="i:${#numbers.sequence(1,calMap.lastDay)}">
<!--                     <th:block th:if="${calMap.date == i}">-->
                        <option th:value="${i}" th:text="${i}" selected="selected" ></option>
<!--                     </th:block>-->
<!--                     <th:block th:unless="${calMap.date == i}">-->
<!--                        <option th:value="${i}" th:text="${i}"></option>-->
                     </th:block>
                  </th:block>
               </select>일
              
            </td>
         </tr>
         <tr>
            <th>거래구분</th>
            <td>
				<select name = "mio">
			        <option th:value="수입">수입</option>
			        <option th:value="지출">지출</option>
			    </select>
            </td>
         </tr>
         <tr>
            <th>내용</th>
            <td>
            	<input type="text" class="form-control" name="content">   
            </td>
         </tr>
        <tr>
            <th>금액</th>
            <td>
            	<input type="number" class="form-control" name="money">      				
            </td>
         </tr>
                
         </table>
         
         
<!--         날짜 누르기 -> ajax에서 받아온 수입지출 data 받아서 여기에 뿌리기 -->
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" >달력</button>
        <button type="submit" class="btn btn-primary" >추가</button>
      </div>
    </div>
  </div>
</div>
   

   <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
   

</body>
</html>






